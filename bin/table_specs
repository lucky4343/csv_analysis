#!/bin/bash
# Date: 10/07/2018
# David Brunelle

# Globals
DATA='Please input files of .CSV format'
ARGS=$#

# Function definitions
standardize() {
    cat $var | sed -r 's/,/, /g' > "$var""_standardized" 
}

read_fields() {
    if [[  -d "$var""_dir" ]] ; then
	echo "Please relocate directory $var"\_dir" then try again"
    
    else
	mkdir "$var"\_dir""
	mv $var "$var"\_dir""
	cd "$var"\_dir""
	
    NUM_FIELDS=$( awk '{FS=","} END {print NF}' $var)
    FIELD=1

    echo $NUM_FIELDS
    #stop split on coordinates by regex ["(]
    
    while [[ $FIELD -le $NUM_FIELDS ]] ; do
	awk -v FIELD="$FIELD" '{ {FS=","} ; {$0=$0} ; {print $FIELD} }' $var > "$var""_""$FIELD"
	FIELD=$(($FIELD + 1))
    done
    
    mv $var ../
    fi
    
}

is_file() {
    if [[ -f $var ]] ; then
	echo 0
    else
        echo 1
    fi
}

is_csv () {
    FILEN_EXTEN=$( echo $var | grep -o '....$' )
    if [[ $FILEN_EXTEN == ".csv" ]] ; then
	echo 0
    else
	echo 2
    fi
}

is_directory() {
    if [[ ! -d $var ]] ; then
	echo 0
    else
	echo 3
    fi
}
    

status_handler() {
    ARG=$@
    if [[ ARG -eq 0 ]] ; then
	#OUTPUT=$( define_output $var )
	#echo cat > $OUTPUT
	#echo $var': is a csv'

	#echo $( standardize "$var" )
	echo $( read_fields "$var" )
    elif [[ ARG -eq 1 ]]; then
	echo $var': is not a file or does not exist within the scope of the  present directory'
    elif [[ ARG -eq 2 ]]; then
	echo $var' :is not of type .csv based on filename extension'
    elif [[ ARG -eq 3 ]] ; then
	echo $var' :is a directory'	
    fi
}

#Too many inputs
if [[ $ARGS -gt 9 ]] ; then
    echo 'Too many inputs'
fi

#No inputs 
if [[ $ARGS == 0 ]] ; then 
    echo $DATA
fi

for var in "$@" ; do

    FILE_CHECK=$( is_file $var )
    
    if [[ FILE_CHECK -eq 0 ]] ; then
	CSV_CHECK=$( is_csv $var )
	
	echo $( status_handler $CSV_CHECK )
	
    else
	DIR_CHECK=$( is_directory $var )
	if [[ $(( $DIR_CHECK && $FILE_CHECK ))  == 1 ]] ; then
	    echo $( status_handler $DIR_CHECK )
	else
	    echo $( status_handler $FILE_CHECK )
	fi
    fi

done
